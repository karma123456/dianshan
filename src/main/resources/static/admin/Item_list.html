<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta charset="UTF-8">
    <title>后台主页</title>
    <script src="../bootstrap/js/jquery/2.0.0/jquery.min.js"></script>
    <link rel="stylesheet" href="../bootstrap/css/bootstrap/3.3.6/bootstrap.min.css">
    <link rel="stylesheet" href="../bootstrap/css/table/bootstrap-table.min.css">
    <script src="../bootstrap/js/bootstrap/3.3.6/bootstrap.min.js"></script>
    <script src="../bootstrap/js/table/bootstrap-table.min.js"></script>
    <!-- bootstrap-table.min.js -->

    <script src="https://cdn.bootcss.com/bootstrap-table/1.11.1/bootstrap-table.min.js"></script>
    <!--fileinput-->
    <script src="../bootstrap-fileinput/js/fileinput.min.js"></script>
    <link rel="stylesheet" href="../bootstrap-fileinput/css/fileinput.min.css">
    <!-- 引入中文语言包 -->

    <script src="https://cdn.bootcss.com/bootstrap-table/1.11.1/locale/bootstrap-table-zh-CN.min.js"></script>

    <style>
        body,#admin,#right{
            margin:0;
            padding:0;
        }
        #admin{
            width:100%;
            height:100%;
        }
        #right{
            float:left;
            width:auto;
            height:100%;
        }
        #break{
            padding-top: 20px;
            padding-left: 20px;
            width: 1100px;
        }
        #break>span{
            display: inline-block;
            float: left;
        }
        #listItem{
            padding-left: 20px;
        }
        #add{
            padding-bottom:8px;
        }
    </style>
</head>
<body>
<div id="admin">

    <!--右边主体 start-->
    <div id="right">
        <!--面包屑导航 start-->
        <div id="break">
            <ul class="breadcrumb">
                <li>
                    <span class="glyphicon glyphicon-home" ></span>
                    <a href="#" style="color: #000;display: inline-block;">首页</a>
                </li>
                <li class="active">
                    商品管理
                </li>
            </ul>
        </div>
        <!--面包屑导航 end-->
        <!--商品列表 start-->
        <div id="listItem">
                <div id="add">
                    <button id="addItem" class="btn btn-primary" data-toggle="modal" data-target="#item_submit">
                        <span class="glyphicon glyphicon-plus">添加商品</span>
                    </button>
                </div>
                <table class="table table-hover" id="mytable">
                </table>
        </div>
        <!--商品列表 end-->
    </div>
    <!--右边主体 end-->
    <!--添加商品模态框-->
    <style>
        #item_submit{

            margin:15px auto auto 100px;
        }
        #mbody{
            padding-left:26%;
        }
        #mbody>div{

            padding-top:10px;
        }
    </style>
    <div>
    <div id="item_submit" class="modal fade" data-backrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div id="head" class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h2>商品提交</h2>
                </div>
                <div class="modal-body" id="mbody">
                    <div class="input-group">
                        <span class="label label-primary">商品名称：</span>
                        <input type="text"  id="title" class="form-control"  placeholder="商品名称">
                    </div>
                    <div class="input-group">
                        <span class="label label-primary">商品价格：</span>
                        <input type="text" id="price" class="form-control" placeholder="商品金额">
                    </div>
                    <div class="input-group">
                        <span class="label label-primary">商品描述：</span>
                        <input type="text" id="desciption" class="form-control" placeholder="商品描述">
                    </div>
                    <div class="input-group">
                        <span class="label label-primary">商品库存：</span>
                        <input type="text"  id="stock" class="form-control" placeholder="商品库存">
                    </div>
                    <div class="input-group">
                        <span class="label label-primary">商品销量：</span>
                        <input type="text" id="sales" class="form-control" placeholder="商品销量">
                    </div>
                    <div class="input-group">
                        <span class="label label-primary">商品图片：</span>
                        <div style="padding-top: 9px;">
                            <input id="file-pic" name="file" type="file" multiple>
                            <form id="form1" enctype ="multipart/form-data">
                            </form>
                        </div>
                        <input type="text" id="imgurl" class="form-control" placeholder="商品图片">
                    </div>

                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button">关闭</button>
                    <button class="btn btn-primary" type="button" id="ItemSubmit">提交</button>
                </div>
            </div>
        </div>
</div>
    </div>
    <!--编辑信息模态框-->
    <div>
    <div id="editmodel" class="modal fade" data-backrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div  class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h2>商品编辑</h2>
                </div>
                <div class="modal-body" >
                    <div class="input-group">
                        <span class="label label-primary">商品名称：</span>
                        <input type="text"  id="edit_title" class="form-control"  placeholder="商品名称">
                    </div>
                    <div class="input-group">
                        <span class="label label-primary">商品价格：</span>
                        <input type="text" id="edit_price" class="form-control" placeholder="商品金额">
                    </div>
                    <div class="input-group">
                        <span class="label label-primary">商品描述：</span>
                        <input type="text" id="edit_desciption" class="form-control" placeholder="商品描述">
                    </div>
                    <div class="input-group">
                        <span class="label label-primary">商品库存：</span>
                        <input type="text"  id="edit_stock" class="form-control" placeholder="商品库存">
                    </div>
		            <div class="input-group">
                        <span class="label label-primary">商品销量：</span>
                        <input type="text" id="edit_sales" class="form-control" placeholder="商品销量">
                    </div>
                    <div class="input-group">
                        <span class="label label-primary">商品图片：</span>
                        <div style="padding-top: 9px;">
                            <input id="file-edit" name="file" type="file" multiple>
                            <form id="edit" enctype ="multipart/form-data">
                            </form>
                        </div>
                        <input type="text" id="edit_imgurl" class="form-control" placeholder="商品图片">
                    </div>

                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button">关闭</button>
                    <button class="btn btn-primary" type="button" id="editSubmit">提交</button>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<script>
//商品信息表格
    $("#mytable").bootstrapTable({
        method : "GET",
        url : "http://localhost:8090/item/list",//请求路径
        xhrFields:{withCredentials:true},
        search:true,
        searchOnEnterKey:true,
        searchAlign:"left",
        striped : true, //是否显示行间隔色
        pageNumber : 1, //初始化加载第一页
        pagination : true,//是否分页
        sidePagination : 'client',//server:服务器端分页|client：前端分页
        pageSize : 8,//单页记录数
        pageList : [ 5, 10, 20, 30 ],//可选择单页记录数
        queryParams : function(params) {//上传服务器的参数
            var temp = {//如果是在服务器端实现分页，limit、offset这两个参数是必须的
                limit : params.limit, // 每页显示数量
                offset : params.offset, // SQL语句起始索引
                Name : $('#search_name').val(),
                Tel : $('#search_tel').val()
            };
            return temp;
        },
        columns : [
            {
                title : '商品名',
                field : 'title',
                width: 160,
            }, {
                title : '商品图片',
                field : 'image',
                formatter:imagesrc,
                width: 160,

            }, {
                title : '商品描述',
                field : 'desciption',
                width: 200,
            }, {
                title : '商品价格',
                field : 'price',
                sortable:true,//排序
                width: 80,
            }, {
                title : '商品库存',
                field : 'stock',
                sortable:true,//排序
                width: 80,
            },{
                title : '商品销量',
                field : 'sales',
                sortable:true,//排序
                width: 80,
            },{
                title : '操作',
                field : 'id',
                formatter : operation,//对资源进行操作
                width: 80,
            }
        ],
        onLoadSuccess: function(){  //加载成功时执行
            console.info("加载成功");
        },
        onLoadError: function(){  //加载失败时执行
            console.info("加载数据失败");
        }
    });
    //图片
    function imagesrc(value, row, index){
        return "<img style='width:30px' src='"+value+"'";
    };

    //删除、编辑操作
    function operation(value, row, index) {
        var htm = "<span class='glyphicon glyphicon-trash' id='del' Itemid='"+value+"' onclick='delItem(this)'></span>&nbsp;&nbsp;<span class='glyphicon glyphicon-edit' editid='"+value+"' onclick='edit(this)'></span>";
        return htm;
    };

//删除
    function delItem(dom){
        var message = confirm("确定删除吗？");
        if(message == true){
            $.ajax({
                type:"POST",
                contentType:"application/x-www-form-urlencoded",
                url:"http://localhost:8090/item/delete",
                data:{
                    "id":$(dom).attr("Itemid"),
                },
                success:function(data){
                    alert("删除成功");
                },
                error:function(data){
                    alert("服务器忙");
                }
            });
        }
    };
    //编辑
	var edit_item = [];
    function edit(dom){
        $.ajax({
            type:"GET",
            url:"http://localhost:8090/item/get",
            data:{
                "id":$(dom).attr("editid"),
            },
            success:function(data){
		        edit_item=data.data;
		        showmodel();
		    },
            error:function(data){
                alert("服务器忙");
            }
        });
    };
    function showmodel(){
	    $("#edit_title").val(edit_item.title);
	    $("#edit_desciption").val(edit_item.desciption);
        $("#edit_price").val(edit_item.price);
        $("#edit_stock").val(edit_item.stock);
        $("#edit_imgurl").val(edit_item.image);
	    $("#edit_sales").val(edit_item.sales);

        $("#editmodel").modal("show");
    };
//商品更新编辑
	$("#editSubmit").on("click",function(){
	    var eid=edit_item.id;
	    var title=$("#edit_title").val();
        var price=$("#edit_price").val();
        var desciption=$("#edit_desciption").val();
        var stock=$("#edit_stock").val();
        var imgurl=$("#edit_imgurl").val();
	    var sales=$("#edit_sales").val();
	    if(title == null || title == ""){
            alert("商品标题不能为空");
            return false;
        }
        if(price == null || price == ""){
            alert("商品价格不能为空");
            return false;
        }
        if(desciption == null || desciption == ""){
            alert("商品描述不能为空");
            return false;
        }
        if(stock == null || stock == ""){
            alert("商品库存不能为空");
            return false;
        }
        if(imgurl == null || imgurl == ""){
            alert("商品图片不能为空");
            return false;
        }
        if(sales == null || sales == ""){
            alert("商品销量不能为空");
            return false;
        }
	    $.ajax({
            type:"POST",
            contentType:"application/x-www-form-urlencoded",
            url:"http://localhost:8090/item/update",
            data:{
		        "id":eid,
                "title":title,
                "price":price,
                "desciption":desciption,
                "stock":stock,
                "imgurl":imgurl,
		        "sales":sales
            },
            xhrFields:{withCredentials:true},
            success:function (data) {
                if(data.status == "success"){
                 
                    alert("编辑成功");
                }else{
                    alert("编辑失败，原因为："+data.data.errMsg);
                }
            },
            error:function (data) {
                alert("编辑失败,原因为:"+data.responseText)
            }
        });
        return false;

	});

//商品创建

    $("#ItemSubmit").on("click",function () {
        var title=$("#title").val();
        var price=$("#price").val();
        var desciption=$("#desciption").val();
        var stock=$("#stock").val();
        var imgurl=$("#imgurl").val();
        var sales=$("#sales").val();
        if(title == null || title == ""){
            alert("商品标题不能为空");
            return false;
        }
        if(price == null || price == ""){
            alert("商品价格不能为空");
            return false;
        }
        if(desciption == null || desciption == ""){
            alert("商品描述不能为空");
            return false;
        }
        if(stock == null || stock == ""){
            alert("商品库存不能为空");
            return false;
        }
        if(imgurl == null || imgurl == ""){
            alert("商品图片不能为空");
            return false;
        }
        if(sales == null || sales == ""){
            alert("商品销量不能为空");
            return false;
        }
        $.ajax({
            type:"POST",
            contentType:"application/x-www-form-urlencoded",
            url:"http://localhost:8090/item/create",
            data:{
                "title":title,
                "price":price,
                "desciption":desciption,
                "stock":stock,
                "imgurl":imgurl,
		 "sales":sales,
            },
            xhrFields:{withCredentials:true},
            success:function (data) {
                if(data.status == "success"){
                  
                    alert("提交成功");
                }else{
                    alert("提交失败，原因为："+data.data.errMsg);
                }
            },
            error:function (data) {
                alert("提交失败,原因为:"+data.responseText);
            }
        });
        return false;
    });
    //商品添加图片上传
    $("#file-pic").fileinput({//初始化上传文件框
        showUpload : false,
        showRemove : false,
        uploadAsync: true,
        uploadLabel: "上传",//设置上传按钮的汉字
        uploadClass: "btn btn-primary",//设置上传按钮样式
        showCaption: false,//是否显示标题
        language: "zh",//配置语言
        uploadUrl: "http://localhost:8090/item/upfile",
        maxFileSize : 0,
        maxFileCount: 1,/*允许最大上传数，可以多个，当前设置单个*/
        enctype: 'multipart/form-data',
        allowedFileExtensions : ["jpg", "png","gif"],/*上传文件格式*/
        msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！",
        dropZoneTitle: "请通过拖拽图片文件放到这里",
        dropZoneClickTitle: "或者点击此区域添加图片",
        showBrowse: false,
        browseOnZoneClick: true,
        slugCallback : function(filename) {
            return filename.replace('(', '_').replace(']', '_');
        }
    });
    //上传文件成功，回调函数
    $("#file-pic").on("fileuploaded", function(event, data, previewId, index) {
        var result = data.response; //后台返回的json
	
	$("#imgurl").val(result.data);
	
        $("#picid").val(result.id);//拿到后台传回来的id，给图片的id赋值序列化表单用
        $.ajax({//上传文件成功后再保存图片信息
            url:'BannerPicAction!savaForm.action',
            type:'post',
            dataType:'json',
            data:$('#form1').serialize(),//form表单的值
            success:function(data,status){
                if (status == "success") {

                    if(data.status == "success"){//提交成功
                    }else{
                        alert("添加失败,编码的错误!");
                    }

                } else {
                    alert("添加失败,ajax请求返回失败!");
                }
            },
            cache:false,                    //不缓存
        });
    });
    $('#savePic').on('click',function (){// 提交图片信息
        $('#file-pic').fileinput('upload');
    });
    //商品信息编辑图片上传
    $("#file-edit").fileinput({//初始化上传文件框
        showUpload : false,
        showRemove : false,
        uploadAsync: true,
        uploadLabel: "上传",//设置上传按钮的汉字
        uploadClass: "btn btn-primary",//设置上传按钮样式
        showCaption: false,//是否显示标题
        language: "zh",//配置语言
        uploadUrl: "http://localhost:8090/item/upfile",
        maxFileSize : 0,
        maxFileCount: 1,/*允许最大上传数，可以多个，当前设置单个*/
        enctype: 'multipart/form-data',
        allowedFileExtensions : ["jpg", "png","gif"],/*上传文件格式*/
        initialPreview: [
            "<img src='__ROOT__"+edit_item.image+"' class='file-preview-image'>"
        ],
        msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！",
        dropZoneTitle: "请通过拖拽图片文件放到这里",
        dropZoneClickTitle: "或者点击此区域添加图片",
        showBrowse: false,
        browseOnZoneClick: true,
        slugCallback : function(filename) {
            return filename.replace('(', '_').replace(']', '_');
        }
    });
    //上传文件成功，回调函数
    $("#file-edit").on("fileuploaded", function(event, data, previewId, index) {
        var result = data.response; //后台返回的json
        $("#edit_imgurl").val(result.data);
        $("#picid").val(result.id);//拿到后台传回来的id，给图片的id赋值序列化表单用
        $.ajax({//上传文件成功后再保存图片信息
            url:'BannerPicAction!savaForm.action',
            type:'post',
            dataType:'json',
            data:$('#edit').serialize(),//form表单的值
            success:function(data,status){
                if (status == "success") {

                    if(data.status == "success"){//提交成功
                    }else{
                        alert("添加失败,编码的错误!");
                    }

                } else {
                    alert("添加失败,ajax请求返回失败!");
                }
            },
            cache:false,                    //不缓存
        });
    });
    $('#savePic').on('click',function (){// 提交图片信息 //
        $('#file-pic').fileinput('upload');
    });
</script>
</body>
</html>